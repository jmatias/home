#!/usr/bin/env bash

SUBCOMMAND_DESC="Install development tools."
SUBCOMMAND_HELP=$(
  cat <<EOH

install eks :  Install tools to assume a role in AWS.
install dev :  Install development tools
install ds  :  Install data science tools.

EOH
)

case ${1} in

install)

  shift
  toolKit=${1}
  shift

  if [ -z $toolKit ]; then
    echo "Must specify a toolkit"
    exit 1
  fi

  case $toolKit in
  eks)

    mypwd=$PWD
    set -e
    clean_up() {
      ARG=$?
      echo "> clean_up"
      rm -rf /tmp/aws_role_credentials
      rm -rf /tmp/oktaauth
      cd $mypwd
      exit $ARG
    }
    trap clean_up EXIT

    . ${SUBCOMMANDS_DIR}/_install-python3
    . ${SUBCOMMANDS_DIR}/_install-okta
    . ${SUBCOMMANDS_DIR}/_install-k8s-tools
    . ${SUBCOMMANDS_DIR}/_install-awscli

    ;;

  dev)

    . ${SUBCOMMANDS_DIR}/_install-python3

    if [[ ! -z "$ZSH" ]]; then
      if ! command -v z >/dev/null 2>&1; then
        git clone https://github.com/agkozak/zsh-z $ZSH_CUSTOM/plugins/zsh-z
        git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $ZSH_CUSTOM/plugins/zsh-syntax-highlighting
      fi

    fi

    if ! command -v golangci-lint >/dev/null 2>&1; then
      curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sudo sh -s -- -b /usr/local/bin v1.30.0
    fi

    . ${SUBCOMMANDS_DIR}/_install-cli-tools

    ;;

  ds)

    . ${SUBCOMMANDS_DIR}/_install-python3
    pip install --upgrade -r ${CONFIGURATION_DIR}/requirements.txt

    ;;

  esac

  ;;

esac
