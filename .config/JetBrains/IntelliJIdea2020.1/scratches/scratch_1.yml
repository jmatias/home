global:
  resolve_timeout: 5m
  slack_api_url: https://xo.chat.***REMOVED***.com/hooks/***REMOVED***
receivers:
- name: "null"
- name: DockerOpErrorSlackMsg
  slack_configs:
  - channel: ***REMOVED***-sandbox
    icon_url: https://www.dropbox.com/s/trj7fi71gor9cgi/icon-emergency-services-2.png?raw=1
    text: |
      Hey, I noticed an increase in the number of Docker operation errors.
      Here are some <https://grafana.***REMOVED***.k8.***REMOVED***.com/d/aVlhMxjZz/***REMOVED***-container-conflict-debugging?orgId=1|**charts:** :bar_chart:> and <https://kibana.***REMOVED***.k8.***REMOVED***.com|**logs:** :clipboard:>.

      If this issue is not urgent, you can temporarily silence me <http://alertmanager.***REMOVED***.k8.***REMOVED***.com/#/silences/new?filter=%7Balertname%3D%22DockerOperationErrors%22%7D | here.>
    title: |
      [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}]  {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}{{ end }}
    title_link: https://grafana.***REMOVED***.k8.***REMOVED***.com/d/aVlhMxjZz/***REMOVED***-container-conflict-debugging?orgId=1
- name: TargetEndpointDownMsg
  slack_configs:
  - channel: ***REMOVED***-sandbox
    icon_url: https://www.dropbox.com/s/trj7fi71gor9cgi/icon-emergency-services-2.png?raw=1
    text: |
      One or more target endpoints are down.
      You can find the list <http://prometheus.***REMOVED***.k8.***REMOVED***.com/graph?g0.range_input=1h&g0.expr=ALERTS%7Balertname%3D%22TargetDown%22%7D&g0.tab=1 | here.>

      If this issue is not urgent, you can temporarily silence me <http://alertmanager.***REMOVED***.k8.***REMOVED***.com/#/silences/new?filter=%7Balertname%3D%22DockerOperationErrors%22%7D | here.>
    title: |
      [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}]  {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}{{ end }}
- name: ServiceDownMsg
  slack_configs:
  - channel: ***REMOVED***-sandbox
    icon_url: https://www.dropbox.com/s/trj7fi71gor9cgi/icon-emergency-services-2.png?raw=1
    text: |2

      {{ range .Alerts.Firing }}
      {{ .Annotations.summary }} URL: {{ .Labels.instance }}
      {{ end }}

      If this issue is not urgent, you can temporarily silence me <http://alertmanager.***REMOVED***.k8.***REMOVED***.com/#/alerts?receiver=ServiceDownMsg | here.>
    title: |
      [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}]  {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}{{ end }}
- name: SyntheticTx
  slack_configs:
  - channel: ***REMOVED***-sandbox
    icon_url: https://www.dropbox.com/s/trj7fi71gor9cgi/icon-emergency-services-2.png?raw=1
    send_resolved: true
    text: |2

      {{ range .Alerts.Firing }}
      {{ .Annotations.summary }} URL: {{ .Labels.instance }}
      {{ end }}

      If this issue is not urgent, you can temporarily silence me <http://alertmanager.***REMOVED***.k8.***REMOVED***.com/#/alerts?receiver=ServiceDownMsg | here.>
    title: |
      [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}]  {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}{{ end }}
route:
  group_by:
  - alertname
  group_interval: 5m
  group_wait: 30s
  receiver: "null"
  repeat_interval: 12h
  routes:
  - continue: false
    group_interval: 30s
    match:
      alertname: DockerOperationErrorCountHigh
    receiver: DockerOpErrorSlackMsg
    repeat_interval: 15m
  - continue: false
    group_interval: 30s
    match:
      alertname: TargetDown
    receiver: TargetEndpointDownMsg
    repeat_interval: 10m
  - continue: false
    group_interval: 30s
    match:
      alertname: ServiceDown
    receiver: ServiceDownMsg
    repeat_interval: 5m
  - continue: false
    group_interval: 30s
    match:
      alertname: SyntheticTransactionError
    receiver: SyntheticTx
    repeat_interval: 1m
